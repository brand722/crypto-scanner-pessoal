# üöÄ GUIA COMPLETO: Deploy na VPS CONTABO - Scanner Cripto

## üìã Especifica√ß√µes Recomendadas da VPS Contabo

### üí∞ Planos Recomendados
| Plano | CPU | RAM | Storage | Banda | Pre√ßo/m√™s | Recomenda√ß√£o |
|-------|-----|-----|---------|-------|-----------|--------------|
| **VPS S** | 4 vCPUs | 8GB | 50GB NVMe | 32TB | ‚Ç¨4.99 | ‚úÖ **IDEAL** |
| VPS M | 6 vCPUs | 16GB | 100GB NVMe | 32TB | ‚Ç¨9.99 | Overkill |
| VPS XS | 2 vCPUs | 4GB | 50GB NVMe | 32TB | ‚Ç¨3.99 | M√≠nimo |

> **üí° Recomenda√ß√£o**: VPS S (4 vCPUs, 8GB RAM) √© perfeito para o scanner cripto

### üåê Configura√ß√£o de Rede
- **IP Fixo**: Inclu√≠do em todos os planos
- **Localiza√ß√£o**: Alemanha (baixa lat√™ncia para APIs cripto)
- **Bandwidth**: 32TB suficiente para aplica√ß√£o

## üõ†Ô∏è CONFIGURA√á√ÉO INICIAL - Ubuntu 24.04

### 1. üîê Primeiro Acesso SSH
```bash
# Conectar via SSH (substitua pelo seu IP)
ssh root@SEU_IP_VPS

# Criar usu√°rio n√£o-root (recomendado)
adduser cripto
usermod -aG sudo cripto

# Configurar chaves SSH (opcional mas recomendado)
mkdir -p /home/cripto/.ssh
cp ~/.ssh/authorized_keys /home/cripto/.ssh/
chown -R cripto:cripto /home/cripto/.ssh
chmod 700 /home/cripto/.ssh
chmod 600 /home/cripto/.ssh/authorized_keys

# Trocar para usu√°rio cripto
su - cripto
```

### 2. üì¶ Atualiza√ß√£o do Sistema
```bash
# Atualizar reposit√≥rios e sistema
sudo apt update && sudo apt upgrade -y

# Instalar utilit√°rios essenciais
sudo apt install -y curl wget git htop nano vim unzip
```

### 3. üî• Configura√ß√£o de Firewall (UFW)
```bash
# Configurar firewall
sudo ufw allow 22/tcp    # SSH
sudo ufw allow 80/tcp    # HTTP
sudo ufw allow 443/tcp   # HTTPS
sudo ufw allow 8501/tcp  # Streamlit (tempor√°rio)
sudo ufw --force enable

# Verificar status
sudo ufw status verbose
```

## üêç INSTALA√á√ÉO DO AMBIENTE PYTHON

### 1. Python 3.12 (Ubuntu 24.04)
```bash
# Python j√° vem instalado no Ubuntu 24.04
python3 --version  # Deve mostrar 3.12.x

# Instalar pip e venv
sudo apt install -y python3-pip python3-venv python3-dev

# Instalar depend√™ncias para compila√ß√£o (necess√°rio para alguns pacotes)
sudo apt install -y build-essential libssl-dev libffi-dev
```

### 2. üåê Nginx e Supervisor
```bash
# Instalar Nginx e Supervisor
sudo apt install -y nginx supervisor

# Habilitar servi√ßos
sudo systemctl enable nginx
sudo systemctl enable supervisor
sudo systemctl start nginx
sudo systemctl start supervisor
```

## üì• DEPLOY DO PROJETO

### 1. üìÅ Preparar Diret√≥rio
```bash
# Criar diret√≥rio do projeto
mkdir -p /home/cripto/apps
cd /home/cripto/apps

# Op√ß√£o A: Upload via SCP (do seu computador local)
# scp -r "C:\Users\brand\Desktop\Tabela Ind" cripto@SEU_IP:/home/cripto/apps/tabela-ind

# Op√ß√£o B: Git clone (se tiver reposit√≥rio)
# git clone https://github.com/seu-usuario/tabela-ind.git

# Op√ß√£o C: Download direto (vamos criar um zip)
```

### 2. üîÑ Script de Upload Autom√°tico
```bash
# No seu computador Windows (PowerShell)
# Criar arquivo upload.ps1:

$VPS_IP = "SEU_IP_VPS"
$VPS_USER = "cripto"
$LOCAL_PATH = "C:\Users\brand\Desktop\Tabela Ind"
$REMOTE_PATH = "/home/cripto/apps/tabela-ind"

# Comprimir projeto
Compress-Archive -Path "$LOCAL_PATH\*" -DestinationPath "tabela-ind.zip" -Force

# Upload via SCP
scp tabela-ind.zip $VPS_USER@$VPS_IP:/home/cripto/apps/

# Conectar e descomprimir
ssh $VPS_USER@$VPS_IP "cd /home/cripto/apps && unzip -o tabela-ind.zip -d tabela-ind && rm tabela-ind.zip"
```

### 3. üêç Ambiente Virtual
```bash
cd /home/cripto/apps/tabela-ind

# Criar ambiente virtual
python3 -m venv venv

# Ativar ambiente
source venv/bin/activate

# Atualizar pip
pip install --upgrade pip

# Instalar depend√™ncias
pip install -r requirements.txt

# Verificar instala√ß√£o
pip list
```

### 4. üß™ Teste Local
```bash
# Testar aplica√ß√£o
streamlit run app.py --server.port 8501 --server.address 0.0.0.0 --server.headless true

# Em outro terminal (ou nova conex√£o SSH)
curl http://localhost:8501

# Se funcionar, parar com Ctrl+C
```

## üåê CONFIGURA√á√ÉO NGINX (Proxy Reverso)

### 1. üìù Configura√ß√£o do Nginx
```bash
# Criar configura√ß√£o
sudo nano /etc/nginx/sites-available/scanner-cripto
```

```nginx
server {
    listen 80;
    server_name SEU_IP_VPS;  # Substitua pelo IP da sua VPS
    
    # Tamanho m√°ximo de upload
    client_max_body_size 100M;
    
    # Configura√ß√µes de timeout
    proxy_connect_timeout 60s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;
    
    location / {
        proxy_pass http://127.0.0.1:8501;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Configura√ß√µes espec√≠ficas para Streamlit
        proxy_buffering off;
        proxy_cache off;
    }
    
    # Headers de seguran√ßa
    add_header X-Frame-Options DENY;
    add_header X-Content-Type-Options nosniff;
    add_header X-XSS-Protection "1; mode=block";
}
```

### 2. ‚úÖ Ativar Configura√ß√£o
```bash
# Ativar site
sudo ln -s /etc/nginx/sites-available/scanner-cripto /etc/nginx/sites-enabled/

# Remover configura√ß√£o padr√£o
sudo rm -f /etc/nginx/sites-enabled/default

# Testar configura√ß√£o
sudo nginx -t

# Reiniciar Nginx
sudo systemctl restart nginx
```

## üîÑ CONFIGURA√á√ÉO SUPERVISOR (Gerenciamento de Processo)

### 1. üìù Configura√ß√£o do Supervisor
```bash
sudo nano /etc/supervisor/conf.d/scanner-cripto.conf
```

```ini
[program:scanner-cripto]
command=/home/cripto/apps/tabela-ind/venv/bin/streamlit run app.py --server.port 8501 --server.address 127.0.0.1 --server.headless true --server.enableCORS false
directory=/home/cripto/apps/tabela-ind
user=cripto
autostart=true
autorestart=true
startretries=3
stderr_logfile=/var/log/scanner-cripto.err.log
stdout_logfile=/var/log/scanner-cripto.out.log
environment=HOME="/home/cripto",USER="cripto"

# Configura√ß√µes de recursos
stopwaitsecs=30
killasgroup=true
stopasgroup=true
```

### 2. ‚úÖ Ativar Supervisor
```bash
# Recarregar configura√ß√µes
sudo supervisorctl reread
sudo supervisorctl update

# Iniciar aplica√ß√£o
sudo supervisorctl start scanner-cripto

# Verificar status
sudo supervisorctl status scanner-cripto
```

## üîí CONFIGURA√á√ÉO DE SEGURAN√áA

### 1. üîë SSH Hardening
```bash
# Editar configura√ß√£o SSH
sudo nano /etc/ssh/sshd_config

# Adicionar/modificar:
Port 2222                    # Mudar porta padr√£o
PermitRootLogin no          # Desabilitar login root
PasswordAuthentication no   # Apenas chaves SSH
AllowUsers cripto          # Apenas usu√°rio espec√≠fico

# Reiniciar SSH
sudo systemctl restart sshd

# Atualizar firewall
sudo ufw delete allow 22
sudo ufw allow 2222/tcp
```

### 2. üõ°Ô∏è Fail2ban (Prote√ß√£o contra ataques)
```bash
# Instalar Fail2ban
sudo apt install -y fail2ban

# Configurar
sudo nano /etc/fail2ban/jail.local
```

```ini
[DEFAULT]
bantime = 3600
findtime = 600
maxretry = 3

[sshd]
enabled = true
port = 2222
logpath = /var/log/auth.log

[nginx-limit-req]
enabled = true
filter = nginx-limit-req
action = iptables-multiport[name=ReqLimit, port="http,https", protocol=tcp]
logpath = /var/log/nginx/error.log
maxretry = 5
findtime = 600
bantime = 7200
```

```bash
# Reiniciar Fail2ban
sudo systemctl enable fail2ban
sudo systemctl start fail2ban
```

### 3. üîÑ Atualiza√ß√µes Autom√°ticas
```bash
# Instalar unattended-upgrades
sudo apt install -y unattended-upgrades

# Configurar
sudo nano /etc/apt/apt.conf.d/50unattended-upgrades

# Habilitar
sudo systemctl enable unattended-upgrades
```

## üìä MONITORAMENTO E LOGS

### 1. üìà Sistema de Monitoramento
```bash
# Instalar ferramentas de monitoramento
sudo apt install -y htop iotop netstat-nat

# Script de monitoramento
nano /home/cripto/monitor.sh
```

```bash
#!/bin/bash
echo "=== STATUS DO SISTEMA ==="
date
echo
echo "=== USO DE CPU ==="
top -bn1 | grep "Cpu(s)" | head -1
echo
echo "=== USO DE MEM√ìRIA ==="
free -h
echo
echo "=== USO DE DISCO ==="
df -h /
echo
echo "=== STATUS DA APLICA√á√ÉO ==="
sudo supervisorctl status scanner-cripto
echo
echo "=== √öLTIMAS LINHAS DO LOG ==="
sudo tail -5 /var/log/scanner-cripto.out.log
```

```bash
chmod +x /home/cripto/monitor.sh
```

### 2. üìù Verifica√ß√£o de Logs
```bash
# Logs da aplica√ß√£o
sudo tail -f /var/log/scanner-cripto.out.log   # Output normal
sudo tail -f /var/log/scanner-cripto.err.log   # Erros

# Logs do Nginx
sudo tail -f /var/log/nginx/access.log         # Acessos
sudo tail -f /var/log/nginx/error.log          # Erros

# Logs do sistema
sudo tail -f /var/log/syslog                   # Sistema geral
```

## üöÄ SCRIPTS DE AUTOMA√á√ÉO

### 1. üì¶ Script de Deploy
```bash
nano /home/cripto/deploy.sh
```

```bash
#!/bin/bash
set -e

echo "üöÄ Iniciando deploy do Scanner Cripto..."

# Ir para diret√≥rio do projeto
cd /home/cripto/apps/tabela-ind

# Backup da vers√£o atual
if [ -d "backup" ]; then
    rm -rf backup.old
    mv backup backup.old
fi
cp -r . backup/

# Atualizar c√≥digo (se usando Git)
# git pull origin main

# Atualizar depend√™ncias
source venv/bin/activate
pip install --upgrade pip
pip install -r requirements.txt

# Reiniciar aplica√ß√£o
sudo supervisorctl restart scanner-cripto

# Aguardar inicializa√ß√£o
sleep 10

# Verificar status
if sudo supervisorctl status scanner-cripto | grep -q "RUNNING"; then
    echo "‚úÖ Deploy conclu√≠do com sucesso!"
else
    echo "‚ùå Erro no deploy. Verificar logs:"
    sudo tail -20 /var/log/scanner-cripto.err.log
    exit 1
fi
```

```bash
chmod +x /home/cripto/deploy.sh
```

### 2. üîÑ Script de Backup
```bash
nano /home/cripto/backup.sh
```

```bash
#!/bin/bash
BACKUP_DIR="/home/cripto/backups"
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_NAME="scanner-cripto-$DATE"

# Criar diret√≥rio de backup
mkdir -p $BACKUP_DIR

# Criar backup
cd /home/cripto/apps
tar -czf "$BACKUP_DIR/$BACKUP_NAME.tar.gz" \
    --exclude='tabela-ind/venv' \
    --exclude='tabela-ind/__pycache__' \
    --exclude='tabela-ind/*.pyc' \
    --exclude='tabela-ind/temp_data.json' \
    tabela-ind/

# Backup dos logs
tar -czf "$BACKUP_DIR/$BACKUP_NAME-logs.tar.gz" \
    /var/log/scanner-cripto.* \
    /var/log/nginx/access.log \
    /var/log/nginx/error.log

# Manter apenas √∫ltimos 7 backups
cd $BACKUP_DIR
ls -t scanner-cripto-*.tar.gz | tail -n +8 | xargs -r rm

echo "‚úÖ Backup criado: $BACKUP_NAME.tar.gz"
```

```bash
chmod +x /home/cripto/backup.sh

# Configurar cron para backup di√°rio
crontab -e
# Adicionar linha:
0 2 * * * /home/cripto/backup.sh
```

## üåê CONFIGURA√á√ÉO DE DOM√çNIO (Opcional)

### 1. üè∑Ô∏è Configurar Dom√≠nio
```bash
# Se voc√™ tem um dom√≠nio, configure:
# 1. No painel da Contabo, configure o DNS reverso
# 2. No seu provedor de dom√≠nio, adicione registro A:
#    scanner.seudominio.com ‚Üí IP_DA_VPS

# Atualizar configura√ß√£o do Nginx
sudo nano /etc/nginx/sites-available/scanner-cripto

# Substituir:
# server_name SEU_IP_VPS;
# Por:
# server_name scanner.seudominio.com;

sudo systemctl reload nginx
```

### 2. üîí SSL/HTTPS com Let's Encrypt
```bash
# Instalar Certbot
sudo apt install -y certbot python3-certbot-nginx

# Obter certificado SSL
sudo certbot --nginx -d scanner.seudominio.com

# Renova√ß√£o autom√°tica
sudo crontab -e
# Adicionar:
0 3 * * * /usr/bin/certbot renew --quiet
```

## ‚úÖ CHECKLIST DE DEPLOY

- [ ] **VPS Contabo configurada** (Ubuntu 24.04)
- [ ] **Usu√°rio n√£o-root criado** e configurado
- [ ] **Firewall UFW configurado** com portas corretas
- [ ] **Python 3.12 e depend√™ncias** instaladas
- [ ] **Projeto uploaded** para /home/cripto/apps/tabela-ind
- [ ] **Ambiente virtual criado** e depend√™ncias instaladas
- [ ] **Aplica√ß√£o testada** localmente na porta 8501
- [ ] **Nginx configurado** como proxy reverso
- [ ] **Supervisor configurado** para gerenciar processo
- [ ] **Seguran√ßa configurada** (SSH hardening, Fail2ban)
- [ ] **Monitoramento configurado** (logs, scripts)
- [ ] **Scripts de automa√ß√£o** criados (deploy, backup)
- [ ] **Dom√≠nio configurado** (opcional)
- [ ] **SSL/HTTPS configurado** (opcional)

## üéØ COMANDOS √öTEIS CONTABO

### üìä Monitoramento
```bash
# Status geral do sistema
./monitor.sh

# Status da aplica√ß√£o
sudo supervisorctl status scanner-cripto

# Logs em tempo real
sudo tail -f /var/log/scanner-cripto.out.log

# Uso de recursos
htop
```

### üîÑ Gerenciamento
```bash
# Reiniciar aplica√ß√£o
sudo supervisorctl restart scanner-cripto

# Deploy nova vers√£o
./deploy.sh

# Criar backup
./backup.sh

# Verificar conex√µes ativas
sudo netstat -tulpn | grep :80
```

### üö® Troubleshooting
```bash
# Se aplica√ß√£o n√£o inicia
sudo supervisorctl status
sudo tail -50 /var/log/scanner-cripto.err.log

# Se Nginx n√£o responde
sudo nginx -t
sudo systemctl status nginx

# Se out of memory
free -h
sudo systemctl restart scanner-cripto
```

## üåü OTIMIZA√á√ïES ESPEC√çFICAS CONTABO

### 1. üíæ Configura√ß√£o de Swap
```bash
# Criar swap de 2GB (recomendado para VPS S)
sudo fallocate -l 2G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile

# Tornar permanente
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab

# Configurar swappiness
echo 'vm.swappiness=10' | sudo tee -a /etc/sysctl.conf
```

### 2. ‚ö° Otimiza√ß√µes de Performance
```bash
# Configurar timezone
sudo timedatectl set-timezone Europe/Berlin

# Otimizar TCP
sudo nano /etc/sysctl.conf
```

```bash
# Adicionar ao final:
net.core.rmem_max = 16777216
net.core.wmem_max = 16777216
net.ipv4.tcp_rmem = 4096 87380 16777216
net.ipv4.tcp_wmem = 4096 65536 16777216
```

## üéâ RESULTADO FINAL

Ap√≥s seguir este guia, voc√™ ter√°:

- ‚úÖ **Scanner Cripto rodando** em produ√ß√£o na Contabo
- ‚úÖ **Alta disponibilidade** com Supervisor
- ‚úÖ **Proxy reverso** Nginx configurado
- ‚úÖ **Seguran√ßa robusta** com firewall e fail2ban
- ‚úÖ **Monitoramento completo** com logs e m√©tricas
- ‚úÖ **Scripts de automa√ß√£o** para deploy e backup
- ‚úÖ **Performance otimizada** para VPS Contabo

**üåê Acesso**: `http://SEU_IP_VPS` ou `https://scanner.seudominio.com`

---

## üí° DICAS FINAIS CONTABO

1. **üí∞ Billing**: Contabo cobra mensalmente, configure alertas de uso
2. **üìç Localiza√ß√£o**: Datacenter alem√£o √© ideal para APIs europeias
3. **üîÑ Backups**: Contabo oferece backups pagos, mas scripts pr√≥prios s√£o mais flex√≠veis
4. **üìä Monitoramento**: Use dashboard da Contabo para monitorar recursos
5. **üéØ Performance**: VPS S √© suficiente, upgrade s√≥ se necess√°rio

**üìû Suporte Contabo**: Responde rapidamente via ticket system
